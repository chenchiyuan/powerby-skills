# PowerBy Bug-Fix Skill

Bug-Fix专项技能，负责故障诊断、修复和验证。专注于小而聚焦的问题解决，采用证据驱动的诊断方法，通过单文档记录完整修复过程。

## 快速开始

### 激活命令
```
/powerby-bugfix
```

### 使用示例
```
用户: /powerby-bugfix

Bug-Fix:
角色已激活：Bug-Fix Specialist - The Troubleshooter
我已准备就绪，请提供问题描述、相关代码和复现步骤。
我将使用单文档方式记录完整修复过程。

用户: 问题描述: 用户登录后页面空白
上下文: 错误日志显示..."

Bug-Fix:
✅ 创建 bugs/bug-001-login-blank-page.md
✅ 完成问题报告章节
✅ 完成诊断分析章节
✅ 制定修复计划（TASK-001, TASK-002）
✅ 执行修复并更新实施章节
✅ 验证交付并完成验证章节
✅ 修复完成，耗时2小时
```

## 核心特性

- 🔍 **证据驱动诊断**: 基于日志、堆栈、代码事实的分析方法
- 📄 **单文档记录**: bug、分析、任务、验证全部在一个文档中
- ⚡ **快速修复**: 专注小而聚焦的问题
- 🎯 **最小代价**: 奥卡姆剃刀原则，选择最直接的修复方案
- ✅ **完整验证**: 确保修复有效且无副作用
- 🧹 **临时文件管理**: 优先调用已有代码，临时脚本统一管理，修复后自动清理
- 📁 **目录整洁**: temp_scripts/目录规范，确保项目结构清晰

## 工作流程

```
问题报告 → 诊断分析 → 修复方案确认 → 用户确认 → 实施修复 → 验证交付
    ↓          ↓          ↓            ↓          ↓          ↓
 bug.md   → analysis.md → proposal.md → confirm → fix.md → verification.md
```

**所有过程都在一个文档中完成**：`docs/bugs/global/bug-{id}.md`

### 七阶段结构（v1.2.0新增用户确认环节）
1. **问题报告** - 问题描述、证据链、复现逻辑
2. **诊断分析** - 代码路径、根因定位、影响范围
3. **修复方案确认** 🆕 - 多方案对比、风险评估、推荐方案
4. **用户确认** 🆕 - 简化确认格式，快速决策
5. **实施修复** - 执行记录、修改明细
6. **验证交付** - 回归测试、代码交付、总结

### 核心特性

#### 🆕 新增用户确认环节
- **单文档记录**: 所有阶段都在同一个bug.md中完成
- **简化确认**: 确认过程简洁高效，无需额外文档
- **快速决策**: 确认格式简单明了，支持快速决策
- **风险可控**: 用户在实施前充分了解风险并做出决策

#### 📋 修复方案报告
1. **问题总结** - 问题概述、影响范围、根本原因
2. **修复逻辑** - 逻辑链路、关键决策点、预期效果
3. **修复方案** - 方案A/B/C对比（思路、优缺点、工作量）
4. **推荐方案** - 推荐理由、选择依据
5. **风险评估** - 技术、业务、时间风险及缓解措施
6. **实施计划** - 任务分解、时间安排、验收标准

#### 简化确认格式
```
确认方案：[方案A/B/C]
意见：
```

## 临时文件管理

### 目录结构
```
temp_scripts/
├── analysis/        # 分析脚本
│   ├── bug-{id}-analyzer.{py|js|sh}
│   └── bug-{id}-log-parser.{py|js|sh}
├── validation/      # 验证脚本
│   ├── bug-{id}-test-{component}.{py|js}
│   └── bug-{id}-regression-check.{py|js}
├── mock/           # 模拟数据
│   ├── bug-{id}-test-data.{json|csv}
│   └── bug-{id}-scenario-{name}.{py|js}
└── logs/           # 临时日志
    ├── bug-{id}-analysis.log
    └── bug-{id}-test-results.log
```

### 使用原则
1. **优先调用已有代码** - 不重复实现已有功能
2. **分类管理** - 按用途将临时文件存放到指定目录
3. **及时清理** - 修复完成后立即清理所有临时文件
4. **安全保护** - 永远不清理项目核心目录和用户数据

### 清理验证
修复完成后必须执行清理检查清单：
- [ ] 分析脚本已删除
- [ ] 验证脚本已删除
- [ ] 模拟数据已删除
- [ ] 临时日志已删除
- [ ] temp_scripts目录已清理（如果为空）
- [ ] 工作目录整洁，无遗留文件

### 详细指南
查看 [Bug-Fix临时脚本使用指南](../../docs/bug-fix-temp-scripts-guide.md) 了解更多用法和最佳实践。

## 核心原则

### 8. 证据驱动诊断（Evidence-Driven Diagnosis）🔍
**钢铁纪律级别原则**

- **证据至上**：拒绝"我觉得"、"可能"。基于日志、堆栈、代码事实
- **溯源推理**：从现象到根因的逻辑链路
- **零假设**：不默认代码正确，质疑矛盾点
- **最小代价**：奥卡姆剃刀原则，最直接的修复

## 目录结构

```
project/
├── bugs/
│   ├── bug-001-[问题标识].md    # 完整的bug修复文档
│   ├── bug-002-[问题标识].md
│   └── index.md                 # Bug索引
```

## 与其他技能的协作

- **powerby-command**: 接收修复任务指令
- **powerby-engineer**: 协作处理复杂问题
- **powerby-code-review**: 提供修复后的代码

## 质量标准

### 完成定义
- [ ] 问题报告完整（证据链、复现逻辑）
- [ ] 根因分析准确（代码路径、根因定位）
- [ ] 修复计划可执行（任务清单、验收标准）
- [ ] 修复有效（回归测试通过）
- [ ] 无副作用（影响范围可控）
- [ ] 文档完整（修复过程记录）

## 版本信息

- **版本**: v1.2.0
- **发布日期**: 2025-12-23
- **适用范围**: Bug诊断与修复（独立流程）

## 变更日志

### v1.2.0 - 2025-12-23
**重大更新**: 新增用户确认环节

#### 核心变更
- 🆕 **新增用户确认环节**: 在修复方案制定后增加用户确认流程
- 📋 **方案报告标准化**: 8个部分的结构化方案报告格式
- ✅ **决策点明确**: 需要用户确认的关键问题和选项
- 🔒 **风险可控**: 用户在实施前充分了解风险并做出决策

#### 具体改进
- 重构工作流程：从5阶段扩展为7阶段
- 新增阶段3：修复方案确认 - 多方案对比、风险评估、推荐方案
- 新增阶段4：用户确认 - 方案确认、风险接受、授权实施
- 更新单文档结构：增加修复方案确认和用户确认章节
- 更新模板：docs/bugs/templates/bug-template.md 包含完整格式

#### 方案报告格式
1. 问题总结（概述、影响范围、根本原因）
2. 修复逻辑（逻辑链路、决策点、预期效果）
3. 修复方案（方案A/B/C对比）
4. 推荐方案（推荐理由、选择依据）
5. 风险评估（技术、业务、时间风险）
6. 实施计划（任务分解、时间安排）
7. 资源需求（人力、技术、测试）
8. 决策点（需要用户确认的问题）

#### 用户确认机制
- 超简确认格式：仅需确认方案和意见
- 单文档记录：所有阶段都在bug.md中完成
- 快速决策：减少文档负担，提高决策效率
- 灵活处理：P0紧急情况先修复后确认

#### 质量保障
- 触发条件：工作量>2小时、涉及多模块、存在技术风险
- 单文档管理：所有过程集中在一个文档
- 简化流程：确认过程高效简洁
- 风险可控：用户充分了解风险后决策

### v1.1.0 - 2025-12-23
**重大更新**: 临时文件管理机制

#### 新增功能
- 🧹 **临时文件管理**: 新增temp_scripts/目录统一管理临时代码
- 📁 **分类存储**: analysis/validation/mock/logs四类目录规范
- 🔧 **优先复用**: 强制要求优先调用项目已有代码
- ✅ **清理验证**: 完整的临时文件清理检查清单

#### 核心改进
- 临时脚本命名规范：bug-{id}-{用途}.{py|js|sh}
- 自动清理机制：修复完成后自动清理临时文件
- 安全保护：永远不清理项目核心目录和用户数据
- 详细指南：提供完整的使用文档和最佳实践

#### 文档更新
- 新增Bug-Fix临时脚本使用指南
- 更新bug模板：包含临时文件管理章节
- 更新README：添加临时文件管理章节

## 许可证

MIT License - 详见 [LICENSE.txt](../../LICENSE.txt)
