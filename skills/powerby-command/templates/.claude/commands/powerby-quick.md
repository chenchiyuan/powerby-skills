---
description: 快速处理临时小需求 - 遵循P0-P5快速流程，增加人工确认环节，严格遵循现有标准
handoffs:
  - label: Quick Init
    agent: powerby-fullstack
    prompt: P0: 快速初始化 - 基于现有架构评估可行性，生成init.md（在现有标准基础上增量扩展）
  - label: Quick Define+Clarify
    agent: powerby-fullstack
    prompt: P1: 需求定稿制 - 融合需求定义与澄清，生成prd.md、function-points.md和clarifications.md，严格遵循现有标准，在P1阶段内部完成澄清工作
  - label: Quick Research
    agent: powerby-fullstack
    prompt: P3: 技术快速调研 - 评估架构兼容性，生成technical-research.md（在现有标准基础上增量扩展）
  - label: Quick Design
    agent: powerby-fullstack
    prompt: P4: 架构快速设计 - 生成architecture.md，严格遵循现有标准，在现有文档基础上增量扩展
  - label: Quick Plan
    agent: powerby-fullstack
    prompt: P5: 任务快速规划 - 生成tasks.md，严格遵循现有标准，在现有文档基础上增量扩展
---

## User Input

```text
$ARGUMENTS
```

## Outline

使用 `/powerby.quick` 命令进行快速需求处理。**必须严格遵循P0-P5快速流程，并在关键节点增加人工确认环节。**

---

## 快速流程说明

### 核心特征
- **时间控制**: 总时间 ≤ 5小时（P0-P5）
- **工作量**: 适用于 ≤ 3天的开发需求
- **架构兼容**: 基于现有架构的增量开发
- **文档精简**: 严格遵循现有标准，但内容精简
- **流程优化**: P1阶段融合需求定义与澄清，减少对话轮次

### 💡 P1+P2融合优化
**问题**：原流程中P1（需求定义）与P2（需求澄清）串行执行，导致AI必须先完成可能存在漏洞的P1文档，才能在P2阶段提出问题，增加冗余对话轮次。

**解决方案**：将P1与P2合并为"需求定稿制"，AI在生成PRD的同时发现模糊点并立即澄清，实现同步推理，减少上下文切换成本，强化单一事实源（SSOT）。

### 适用场景
✅ **适用**：
- 基于现有架构的小功能需求
- 临时性功能开发
- 简单Bug修复或优化
- 已有项目的功能扩展

❌ **不适用**：
- 全新系统设计
- 复杂跨域需求
- 大型重构或架构变更

---

## 执行流程

### P0: 快速初始化
**目标**: 快速评估需求可行性和约束条件

**输出**: `docs/iterations/{id}-{name}/init.md`（在现有标准基础上增量扩展）

**检查要点**:
- 需求背景已理解
- 约束条件已明确
- 可行性已评估（工作量≤3天）
- 架构兼容性已初步评估

---

### P1: 需求定稿制 ⭐
**目标**: 融合需求定义与澄清，在同一阶段内完成PRD生成和模糊点消除

**输出**:
- `docs/iterations/{id}-{name}/prd.md`（严格遵循prd.md标准，在现有文档基础上增量扩展）
- `docs/iterations/{id}-{name}/function-points.md`（严格遵循function-points.md标准，在现有文档基础上增量扩展）
- `docs/iterations/{id}-{name}/clarifications.md`（严格遵循clarifications.md标准，在P1阶段内部生成）

**执行流程**:
1. **需求草拟与自检**：生成PRD草案，同步识别模糊点并列出[AI待澄清事项清单]
2. **交互式澄清**：向用户展示澄清事项，获取回复并实时更新文档
3. **最终确认**：确保所有文档无矛盾，澄清记录完整

**检查要点**:
- [ ] MVP核心价值已用一句话定义
- [ ] P0功能点数量 ≤ 5个
- [ ] 范围边界已明确(In-Scope / Out-of-Scope)
- [ ] 关键模糊点已识别并澄清（≤3个）
- [ ] clarifications.md完整记录澄清历史
- [ ] 文档无[TBD]或模糊描述

**💡 流程优化**: 避免"P1完成→等待确认→进入P2"的冗余循环，AI在生成PRD的同时发现并解决模糊点

**🚨 人工确认环节**: P1完成后**必须停止**，等待人工确认产品功能列表

**确认模板**:
```markdown
## 人工确认：产品功能列表

基于PRD文档 (docs/iterations/{id}-{name}/prd.md) 和澄清记录 (docs/iterations/{id}-{name}/clarifications.md)，请确认：

### 确认清单
- [ ] 核心价值定义是否准确？
- [ ] P0功能列表是否完整？
- [ ] 范围边界是否明确？
- [ ] 验收标准是否可测试？
- [ ] 澄清记录是否清晰完整？

### 确认结果
[ ] ✅ 确认通过，可进入P3
[ ] ❌ 需要修改，修改意见如下：
   - [具体修改意见1]
   - [具体修改意见2]

### 确认人
姓名：___________
日期：___________
```

---

### P3: 技术快速调研
**目标**: 基于现有架构快速评估技术可行性

**输出**: `docs/iterations/{id}-{name}/technical-research.md`（严格遵循technical-research.md标准，在现有文档基础上增量扩展）

**检查要点**:
- 架构兼容性已评估
- 技术选型已确认
- 技术风险已识别

---

### P4: 架构快速设计 ⭐
**目标**: 设计最小可行的技术实现方案

**输出**:
- `docs/iterations/{id}-{name}/architecture.md`（严格遵循architecture.md标准，在现有文档基础上增量扩展）
- `docs/iterations/{id}-{name}/data-model.md`（可选）
- `docs/iterations/{id}-{name}/contracts/`（可选）

**检查要点**:
- [ ] 组件设计已完成
- [ ] 数据流已明确
- [ ] 关键决策已做出
- [ ] 架构图已绘制

**🚨 人工确认环节**: P4完成后**必须停止**，等待人工确认架构实现

**确认模板**:
```markdown
## 人工确认：架构实现

基于架构设计文档 (docs/iterations/{id}-{name}/architecture.md)，请确认：

### 确认清单
- [ ] 组件设计是否合理？
- [ ] 数据流是否正确？
- [ ] 技术选型是否合适？
- [ ] 架构决策是否有依据？

### 确认结果
[ ] ✅ 确认通过，可进入P5
[ ] ❌ 需要修改，修改意见如下：
   - [具体修改意见1]
   - [具体修改意见2]

### 确认人
姓名：___________
日期：___________
```

---

### P5: 任务快速规划
**目标**: 将架构设计转化为可执行的任务清单

**输出**:
- `docs/iterations/{id}-{name}/tasks.md`（严格遵循tasks.md标准，在现有文档基础上增量扩展）
- `docs/iterations/{id}-{name}/checklists/`（可选）

**检查要点**:
- 任务分解已完成
- 任务粒度合适（1天可完成）
- 依赖关系已明确
- 验收标准已定义

---

## 质量门禁 (Q-Gates)

| 门禁编号 | 对应阶段 | 检查时机 | 通过标准 |
|----------|----------|----------|----------|
| **Q-Gate 0** | P0→P1 | 快速初始化完成 | 需求背景、约束条件、可行性评估完成 |
| **Q-Gate 1** | P1→P3 | 需求定义+澄清完成 | MVP价值、功能点、范围边界、8要素完整、模糊点已澄清 |
| **Q-Gate 3** | P3→P4 | 技术调研完成 | 架构兼容性、技术选型、风险识别完成 |
| **Q-Gate 4** | P4→P5 | 架构设计完成 | 组件设计、数据流、决策记录完成 |
| **Q-Gate 5** | P5→P7 | 任务规划完成 | 任务分解、依赖关系、验收标准完成 |

**所有Q-Gate必须通过才能进入下一阶段**

---

## 输出文档清单

```
docs/iterations/{id}-{name}/
├── init.md                    # P0: 快速初始化（在现有标准基础上增量扩展）
├── prd.md                     # P1: 产品需求文档（遵循prd.md标准，在现有文档基础上增量扩展）
├── function-points.md         # P1: 功能点清单（遵循function-points.md标准，在现有文档基础上增量扩展）
├── clarifications.md          # P1: 需求澄清（在P1阶段内部生成）
├── technical-research.md      # P3: 技术调研（遵循technical-research.md标准，在现有文档基础上增量扩展）
├── architecture.md            # P4: 架构设计（遵循architecture.md标准，在现有文档基础上增量扩展）
├── data-model.md              # P4: 数据模型（可选）
├── contracts/                 # P4: API契约（可选）
├── tasks.md                   # P5: 任务清单（遵循tasks.md标准，在现有文档基础上增量扩展）
└── checklists/                # P5: 验收清单（可选）
```

**重要原则**:
- ✅ 所有文档严格遵循现有PowerBy标准
- ✅ 文档结构、命名、格式与标准流程完全一致
- ✅ **在现有文档基础上增量扩展，不创建新的文档类型**

---

## 使用示例

### 示例1：添加简单功能
```bash
/powerby.quick 为现有电商系统添加用户收藏功能，预计2天完成
```

**执行流程**:
1. P0: 快速初始化 → 评估可行性
2. P1: 需求定稿制 → 生成PRD、功能点清单和澄清记录（融合定义与澄清）
3. **停止** → 人工确认产品功能列表
4. P3: 技术快速调研 → 评估架构兼容性
5. P4: 架构快速设计 → 设计实现方案
6. **停止** → 人工确认架构实现
7. P5: 任务快速规划 → 生成任务清单
8. 交付给 `/powerby.implement` 或 `powerby-engineer`

**💡 流程优化**: P1阶段融合了原来P1+P2的工作，避免了冗余的对话轮次

### 示例2：优化现有功能
```bash
/powerby.quick 优化搜索功能性能，基于当前架构，预计3天
```

---

## 前置条件

- ✅ 项目已初始化 (`/powerby.initialize` 已完成)
- ✅ 现有架构文档存在
- ✅ 用户明确表示这是临时小需求
- ✅ 预估工作量 ≤ 3天

---

## 下一步

快速流程完成后：

**选项1**: 使用 `/powerby.implement` 进行开发实现
```bash
/powerby.implement --tasks-path=docs/iterations/{id}-{name}/tasks.md
```

**选项2**: 直接交给 `powerby-engineer` 进行实现
```bash
请使用 powerby-engineer skill，基于 docs/iterations/{id}-{name}/tasks.md 进行开发实现
```

---

## 错误处理

### 错误类型1: 需求过于复杂
```
错误: 预估工作量超过3天，不适合快速流程
解决: 请使用标准流程 /powerby.define → /powerby.design → /powerby.plan
```

### 错误类型2: 需要全新架构
```
错误: 需要全新架构设计，不适合快速流程
解决: 请使用标准流程，通过 /powerby.design 进行完整架构设计
```

### 错误类型3: Q-Gate失败
```
错误: Q-Gate {n} 检查失败
解决: 请查看失败原因并修正，然后重新执行相应阶段
```

### 错误类型4: 人工确认未通过
```
错误: 人工确认未通过
解决: 根据确认意见修改文档，重新提交确认
```

---

## 最佳实践

### ✅ 推荐做法
1. **严格控制范围**: P0功能不超过5个
2. **复用优先**: 最大化复用现有架构和代码
3. **快速决策**: 在信息不完全的情况下做出合理决策
4. **文档精简**: 只记录关键信息，避免过度文档化
5. **及时交付**: 完成后立即交给工程师实现

### ❌ 避免做法
1. **范围膨胀**: 不要因为是"小需求"就随意添加功能
2. **过度设计**: 避免为小需求设计复杂架构
3. **拖延决策**: 不要因为追求完美而延误交付
4. **跳过门禁**: 不要跳过Q-Gate检查
5. **绕过确认**: 不要跳过人工确认环节

---

## 成功标准

```
✅ 快速需求处理完成

📄 遵循快速流程:
  ✓ P0: 快速初始化
  ✓ P1: 需求快速定义+澄清
  ✓ ✓ 人工确认：产品功能列表
  ✓ P3: 技术快速调研
  ✓ P4: 架构快速设计
  ✓ ✓ 人工确认：架构实现
  ✓ P5: 任务快速规划

📄 输出文档:
  └── docs/iterations/{id}-{name}/ (7个核心文档)

🔒 质量门禁 Q-Gate 0-5:
  ✓ 所有Q-Gate通过
  ✓ 人工确认通过
  ✓ 文档质量达标

🎯 下一步: 交给 /powerby.implement 或 powerby-engineer 进行实现
```

### 效率指标
- 总时间 ≤ 5小时
- 相比标准流程节省时间 ≥ 70%
- 文档数量精简但完整

### 质量指标
- Q-Gate通过率 ≥ 90%
- 人工确认通过率 ≥ 95%
- 与现有架构兼容性 = 100%
