---
description: Bug诊断与修复 - 采用三层立体诊断分析框架，独立于P0-P8流程，先对齐需求再诊断修复
---

## User Input

```text
$ARGUMENTS
```

## Outline

使用 `/powerby-bugfix` 命令启动Bug诊断与修复流程。此命令会调用powerby-bugfix技能，采用三层立体诊断分析框架和单文档记录完整修复过程。

### 七阶段执行步骤：

1. **需求对齐与澄清** 🔍
   - 查找相关PRD文档和需求条目
   - 对齐业务目标和功能期望
   - **量化明确表达正确情况**（功能表现、业务逻辑、数据状态、边界条件、异常处理）
   - 提交用户确认需求理解

2. **问题现象描述**
   - 详细描述问题现象
   - 收集相关日志和错误信息
   - 记录复现步骤
   - 标注影响范围和严重程度

3. **三层立体诊断分析** 🔬
   - 表现层诊断：UI表现、用户交互、界面响应
   - 逻辑层诊断：业务逻辑、算法流程、数据处理
   - 数据层诊断：数据存储、数据传输、数据完整性
   - 三层联动验证：跨层一致性检查 + 反向排除验证 + 整体检查

4. **修复方案确认**
   - 设计至少两个修复选项
   - 分析各方案优缺点
   - 评估对系统的影响
   - 提交用户确认

5. **用户确认**
   - 获取用户对修复方案的确认
   - 记录用户意见

6. **实施修复**
   - 编写修复代码
   - 添加必要的注释
   - 编写验证测试
   - 提交代码变更

7. **验证交付**
   - 运行复现测试用例
   - 执行回归测试
   - 验证边界条件
   - 确认修复效果

### 前置条件：

- ✅ 问题描述清晰（必须）
- ✅ 错误日志或代码片段（必须）
- ✅ 复现步骤（如果可能）
- ✅ **用户必须确认需求理解正确后才能开始诊断**

### 输出格式：

```
✅ Bug-Fix 任务完成

📋 问题报告: bugs/bug-001-{问题标识}.md
🎯 修复状态: 已完成
⏱️ 修复时间: X小时

🔍 诊断结果: [根因]
🔧 修复方案: [方案]
✅ 验证结果: [验证]
```

### 使用示例：

```
/powerby-bugfix 问题描述: 用户登录后页面空白 上下文: 错误日志显示...
```

### 功能特性：

1. **需求对齐与澄清** 🔍
   - 查找相关PRD文档和需求条目
   - 对齐业务目标和功能期望
   - **量化明确表达正确情况**

2. **三层立体诊断分析** 🔬
   - 表现层-逻辑层-数据层立体诊断框架
   - 四重验证机制：双重验证+跨层验证+整体检查+严格判定
   - 完整证据链：正向证据链+反向排除链

3. **单文档记录**
   - 所有内容在一个文件中：docs/bugs/global/bug-{id}.md
   - 七阶段结构清晰划分

4. **独立流程**
   - 不依赖P0-P8生命周期
   - 完全聚焦问题诊断和修复

5. **GitHub分支管理集成**
   - 自动创建bugfix/hotfix分支
   - 自动合并和清理分支

6. **最小代价修复**
   - 奥卡姆剃刀原则
   - 选择最直接的修复方案

### 适用场景：

- 代码中的bug或异常
- 功能不按预期工作
- 性能问题
- 兼容性问题
- 任何需要调试和修复的技术问题

**注意**：此命令专注于独立的小问题修复，不适用于大规模重构或新功能开发。
