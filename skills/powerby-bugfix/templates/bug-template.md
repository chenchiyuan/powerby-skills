# Bug-Fix Report #{id} - [问题简述]

## 一、问题报告

### 1.1 需求对齐与澄清 🔍
#### 1.1.1 相关需求查找
- **相关PRD文档**：[列出相关的PRD文档]
- **相关需求条目**：[列出具体的需求条目]
- **相关功能模块**：[列出功能模块名称]

#### 1.1.2 需求对齐
- **业务目标**：[明确业务要达成的目标]
- **功能期望**：[用户期望该功能如何工作]
- **验收标准**：[如何判断功能是否正确]

#### 1.1.3 充分理解与状态定义 ✅
**充分理解需求之后，根据文档需求量化明确表达正确情况**：
- **功能表现**：[UI应该如何显示/交互]
- **业务逻辑**：[数据应该如何处理/流转]
- **数据状态**：[数据应该如何存储/更新]
- **边界条件**：[在什么情况下应该如何处理]
- **异常处理**：[遇到错误时应该如何响应]

#### 1.1.4 用户确认 📋
```
需求对齐确认：
- [ ] 相关需求理解正确
- [ ] 正确状态定义清晰
- [ ] 验收标准明确可量化
- [ ] 可以开始诊断分析

签名：[您的签名]
日期：[日期]
```

### 1.2 问题现象描述
#### 1.2.1 问题表现
[简明扼要描述问题表现]

#### 1.2.2 证据链
- 错误日志: [具体日志内容]
- 堆栈信息: [异常堆栈]
- 代码片段: [相关代码]
- 环境信息: [系统/版本等]

#### 1.2.3 复现逻辑
[详细描述如何稳定复现该问题]

### 1.3 影响评估
- 影响范围: [影响的功能/模块]
- 严重程度: P0/P1/P2
- 紧急程度: 高/中/低

---

## 二、诊断分析

### 2.1 表现层诊断
#### 2.1.1 代码分析
- **相关代码**：列出表现层相关代码文件
  - 前端组件：[文件路径]
  - UI逻辑：[文件路径]
  - 交互处理：[文件路径]
- **逻辑审查**：代码逻辑是否正确实现预期表现
- **异常检测**：是否存在隐藏的UI异常或竞态条件

#### 2.1.2 表现分析
- **预期表现**：应该显示什么
- **实际表现**：实际显示什么
- **差异对比**：预期vs实际的差异
- **触发条件**：在什么操作下出现异常

#### 2.1.3 表现层验证结论
✅ **正确性证明**：[列出证明表现层正确的证据]
❌ **错误性排除**：[列出排除的表现层错误可能性]

### 2.2 逻辑层诊断
#### 2.2.1 代码分析
- **相关代码**：列出逻辑层相关代码文件
  - 业务逻辑：[文件路径]
  - 算法实现：[文件路径]
  - 数据处理：[文件路径]
- **业务逻辑**：业务规则实现是否正确
- **异常检测**：是否存在逻辑漏洞、边界条件未处理

#### 2.2.2 表现分析
- **逻辑流程**：业务逻辑的执行路径（用Mermaid图描述）
- **状态变化**：逻辑执行中的状态转换
- **结果输出**：逻辑处理的结果
- **调用链**：逻辑层被调用和调用的路径

#### 2.2.3 逻辑层验证结论
✅ **正确性证明**：[列出证明逻辑层正确的证据]
❌ **错误性排除**：[列出排除的逻辑层错误可能性]

### 2.3 数据层诊断
#### 2.3.1 代码分析
- **相关代码**：列出数据层相关代码文件
  - 数据库操作：[文件路径]
  - API调用：[文件路径]
  - 数据模型：[文件路径]
- **数据操作**：CRUD操作是否正确、完整、一致
- **异常检测**：是否存在数据一致性风险、并发问题

#### 2.3.2 表现分析
- **数据流向**：数据如何流入流出（用Mermaid图描述）
- **数据状态**：数据的当前状态（原始数据、处理中、结果）
- **数据完整性**：数据是否完整一致，无丢失或损坏
- **数据一致性**：是否存在脏读、幻读等并发问题

#### 2.3.3 数据层验证结论
✅ **正确性证明**：[列出证明数据层正确的证据]
❌ **错误性排除**：[列出排除的数据层错误可能性]

### 2.4 三层联动验证
#### 2.4.1 跨层一致性检查
| 验证点 | 表现层证据 | 逻辑层证据 | 数据层证据 | 结论 |
|--------|------------|------------|------------|------|
| 表现↔逻辑 | [表现如何由逻辑驱动] | [逻辑如何影响表现] | - | 一致/不一致 |
| 逻辑↔数据 | - | [逻辑如何处理数据] | [数据如何驱动逻辑] | 一致/不一致 |
| 数据↔表现 | [数据变化如何反映到UI] | - | [表现如何基于数据] | 一致/不一致 |

#### 2.4.2 反向排除验证
**假设某层有错误，观察是否会影响到其他层**：

- **表现层错误假设**：
  - 影响逻辑层的可能性：[分析] → 排除/确认
  - 影响数据层的可能性：[分析] → 排除/确认
  - 排除结论：[原因]

- **逻辑层错误假设**：
  - 影响表现层的可能性：[分析] → 排除/确认
  - 影响数据层的可能性：[分析] → 排除/确认
  - 排除结论：[原因]

- **数据层错误假设**：
  - 影响表现层的可能性：[分析] → 排除/确认
  - 影响逻辑层的可能性：[分析] → 排除/确认
  - 排除结论：[原因]

#### 2.4.3 证据链构建
```
完整证据链：
问题表现 → 表现层分析 → 逻辑层分析 → 数据层分析 → 根因定位

正向证据链：
表现异常 ← [表现层证明] ← 逻辑异常 ← [逻辑层证明] ← 数据异常 ← [数据层证明]

反向排除链：
[表现层正常] + [逻辑层正常] + [数据层异常] → 数据层为根因
[表现层正常] + [逻辑层异常] + [数据层正常] → 逻辑层为根因
[表现层异常] + [逻辑层正常] + [数据层正常] → 表现层为根因
```

### 2.5 最终诊断结论
#### 2.5.1 问题定位
- **根因所在层**：[表现层/逻辑层/数据层/跨层组合]
- **具体位置**：[代码文件+行号/函数名]
- **触发机制**：[如何触发的问题]
- **根因描述**：[用因果关系说明为什么会出现这个问题]

#### 2.5.2 影响范围
- **影响的表现层**：[哪些UI表现受影响]
- **影响的逻辑层**：[哪些业务逻辑受影响]
- **影响的数据层**：[哪些数据受影响]
- **影响的用户**：[影响哪些用户群体]
- **影响的功能**：[影响哪些功能模块]

#### 2.5.3 严重程度评估
**判定标准**：数据+逻辑+需求+表现均正确才视为正确

- **表现层影响**：[无/轻微/严重]
- **逻辑层影响**：[无/轻微/严重]
- **数据层影响**：[无/轻微/严重]
- **综合评估**：[P0/P1/P2/P3]
  - P0：数据层严重问题，影响数据完整性
  - P1：逻辑层严重问题，影响核心业务
  - P2：表现层问题，影响用户体验
  - P3：轻微问题，不影响主要功能

#### 2.5.4 修复优先级
- **优先级**：[P0/P1/P2/P3]
- **紧急程度**：[高/中/低]
- **修复窗口**：[立即/24小时内/本周内/下个迭代]
- **修复建议**：[初步修复思路和方案]

---

## 三、修复方案确认
### 修复方案
[记录最终选择的修复方案]

### 任务清单
- [ ] TASK-{id}-001: [具体修复任务1]
  - 描述: [详细描述]
  - 优先级: P0/P1/P2
  - 预估工时: X小时
  - 验收标准: [具体标准]
  - 状态: 待开始/进行中/已完成

- [ ] TASK-{id}-002: [具体修复任务2]
  - 描述: [详细描述]
  - 优先级: P0/P1/P2
  - 预估工时: X小时
  - 验收标准: [具体标准]
  - 状态: 待开始/进行中/已完成

### 风险评估
- 潜在风险: [可能引入的新问题]
- 缓解措施: [如何避免风险]

### 用户确认
```
确认方案：[方案A/方案B/方案C]
意见：[用户意见]
签名：[您的签名]
日期：[日期]
```

---

## 四、用户确认
### 确认内容
[用户对修复方案的确认意见]

### 修改意见
[如有修改意见，详细说明]

---

## 五、实施修复
### 执行记录
[记录实际执行过程，与计划对比]

### 临时文件使用记录
本次修复过程中创建了以下临时文件：

#### 分析脚本
- `temp_scripts/analysis/bug-{id}-code-analyzer.{py|js|sh}` - [用途说明]
- `temp_scripts/logs/bug-{id}-analysis.log` - [分析结果说明]

#### 验证脚本
- `temp_scripts/validation/bug-{id}-test-{component}.{py|js}` - [用途说明]
- `temp_scripts/validation/bug-{id}-regression-check.{py|js|sh}` - [用途说明]

#### 模拟数据
- `temp_scripts/mock/bug-{id}-test-data.{json|csv|yaml}` - [数据说明]
- `temp_scripts/mock/bug-{id}-scenario-{name}.{py|js}` - [场景说明]

#### 清理状态
- [ ] 分析脚本已删除
- [ ] 验证脚本已删除
- [ ] 模拟数据已删除
- [ ] 临时日志已删除
- [ ] temp_scripts目录已清理（如果为空）

### 修改明细
[列出所有代码修改]

---

## 六、验证测试
### 回归测试
[证明修复有效]

### 防御性变更
[是否添加了断言或快速失败逻辑]

### 代码交付
```diff
[提供diff格式的代码变更]
```

### 临时文件清理验证
**清理检查清单**：
- [ ] `temp_scripts/analysis/` 目录已清空
- [ ] `temp_scripts/validation/` 目录已清空
- [ ] `temp_scripts/mock/` 目录已清空
- [ ] `temp_scripts/logs/` 目录已清空
- [ ] `temp_scripts/` 目录已删除（如果为空）
- [ ] 工作目录整洁，无遗留临时文件
- [ ] 项目目录结构完整

**清理命令记录**：
```bash
# 示例清理命令
find temp_scripts -name "*bug-{id}*" -type f -delete
find temp_scripts -type d -empty -delete
[ -d temp_scripts ] && [ -z "$(ls -A temp_scripts)" ] && rmdir temp_scripts
```

---

## 七、交付归档
### 最终报告
- 修复时间: [实际用时]
- 效果验证: [是否完全解决]
- 临时文件: [已清理/未清理（说明原因）]
- 经验总结: [学到的教训]
- 预防措施: [如何避免类似问题再次发生]

### 分支管理
#### 合并状态
- [ ] 分支已合并到目标分支
- [ ] 本地分支已删除
- [ ] 远程分支已删除

#### 分支状态验证
- [ ] 分支列表中无残留分支
- [ ] 合并历史记录正确
- [ ] 目标分支包含修复内容

### 文档归档
- [ ] 修复文档已归档到 docs/bugs/archived/
- [ ] 知识库已更新
- [ ] 相关文档已关联
